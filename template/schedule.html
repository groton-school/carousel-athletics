<!DOCTYPE html>
<html lang="en">
  <head>
    <title></title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Arimo&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        grid-template-rows: 1fr auto 1.618fr;
        font-family: 'Arimo', sans-serif;
        font-size: 50px;
        color: #4f4f4f;
        background-color: hsl(351, 8%, 83%);
      }

      .content::before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        background-image: url('seal.png');
        background-position: center;
        background-repeat: no-repeat;
        background-size: 50vh;
        opacity: 0.05;
      }

      .content {
        grid-column: 2;
        grid-row: 2;
        display: flex;
        flex-direction: column;
        justify-content: space-around;
        margin: 30px;
      }

      .content.team .team {
        display: none;
      }

      table {
        border-collapse: collapse;
      }

      td {
        padding: 0 0.5em;
      }

      h1 {
        font-family: 'Libre Baskerville', serif;
        color: #8e0f11;
        margin-top: 0;
        font-size: 75px;
      }

      tr:nth-child(even) {
        background: hsla(351, 8%, 63%, 0.25);
      }
    </style>
  </head>
  <body>
    <div class="content"></div>
    <script>
      const args = new URLSearchParams(window.location.search);
      const params = new URLSearchParams();
      let clean = true;
      args.forEach((value, key) => {
        if (value.toString().length > 0) {
          params.append(key, value);
        } else {
          clean = false;
        }
      });
      if (!clean) {
        window.location.search = params.toString();
      } else {
        const content = document.querySelector('.content');
        const title = params.get('title');
        const title_position = params.get('title_position');
        const hide_scoreless = !!params.get('hide_scoreless');
        params.delete('title');
        params.delete('title_position');
        params.delete('hide_scoreless');
        fetch('schedule?' + params.toString())
          .then((response) => response.json())
          .then((schedule) => {
            let baseTitle = '';
            if (params.has('team_id')) {
              baseTitle = schedule[0].team.name;
              content.classList.add('team');
            } else {
              baseTitle = `${new Date(schedule[0].game_date).toLocaleDateString(
                'en-us',
                { month: 'long', day: 'numeric' }
              )} &ndash; ${new Date(
                schedule[schedule.length - 1].game_date
              ).toLocaleDateString('en-us', {
                month: 'long',
                day: 'numeric'
              })}`;
            }
            switch (title_position) {
              case 'prepend':
                content.innerHTML = `<h1>${title}${baseTitle}</h1>`;
                break;
              case 'replace':
                content.innerHTML = `<h1>${title}</h1>`;
                break;
              case 'append':
                content.innerHTML = `<h1>${baseTitle}${title}</h1>`;
                break;
              default:
                content.innerHTML = `<h1>${baseTitle}</h1>`;
            }
            document.head.title = content.innerText;
            const box = document.createElement('table');
            let prevDate;
            schedule.forEach((e) => {
              const entry = document.createElement('tr');
              entry.classList.add('entry');
              try {
                entry.innerHTML = `
                <td class="date">${
                  prevDate != e.game_date
                    ? new Date(e.game_date).toLocaleDateString('en-us', {
                        month: 'long',
                        day: 'numeric'
                      })
                    : ''
                }</td>
                <td class="team">${e.team.name}</td>
                <td class="opponent">${
                  e.opponents
                    ? e.opponents.map((o) => o.name).join(', ')
                    : e.title
                }</td>
                <td class="score">${
                  e.opponents ? e.opponents.map((o) => o.score).join(', ') : ''
                }</td>
                <td class="outcome">${
                  e.scrimmage
                    ? 'Scrimmage'
                    : e.opponents
                    ? e.opponents.map((o) => o.win_loss).join(', ')
                    : ''
                }</td>
              `;
              } catch (er) {
                console.error({ entry: e, error: er });
              }
              if (
                !hide_scoreless ||
                (hide_scoreless &&
                  entry.querySelector('.score').innerText != '')
              ) {
                box.appendChild(entry);
                prevDate = e.game_date;
              }
            });
            content.appendChild(box);
          });
      }
    </script>
  </body>
</html>
